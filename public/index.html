<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <link
            rel="stylesheet"
            href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
            integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
            crossorigin="anonymous"
        />
        <link
            rel="stylesheet"
            href="https://use.fontawesome.com/releases/v5.5.0/css/all.css"
            integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU"
            crossorigin="anonymous"
        />
        <link rel="stylesheet" type="text/css" href="css/mystyle.css" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Formulario de ingresos de datos</title>
    </head>
    <body>
        <button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal">Cargue sus datos</button>

        <!-- Modal -->
        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-body">
                        <form>
                            <div class="row">
                                <div class="col">
                                    <input type="text" class="form-control" placeholder="Nombre" id="nombre" />
                                </div>
                                <div class="col">
                                    <input type="text" class="form-control" placeholder="Apellido" id="apellido" />
                                </div>
                            </div>
                            <br />
                            <div class="row">
                                <div class="col">
                                    <input type="text" class="form-control" placeholder="Edad" />
                                </div>
                                <div class="col">
                                    <input type="text" class="form-control" placeholder="Alias" />
                                </div>
                            </div>
                            <br />
                            <div class="form-group">
                                <label for="exampleInputEmail1">Email</label>
                                <input type="email" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp" placeholder="Enter email" />
                                <small id="emailHelp" class="form-text text-muted">Esto queda entre nosotres.</small>
                            </div>
                            <div class="form-group">
                                <label for="avatar">Ingrese la url de su avatar</label>
                                <input type="text" class="form-control" id="avatar" placeholder="Avatar" />
                            </div>
                            <button type="button" class="btn btn-primary" id="botonSub">Submit</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div class="container mt-5 mb-5">
            <div class="row">
                <div class="col-md-6 offset-md-3">
                    <h4>ChatRoom</h4>
                    <ul class="timeline" id="msgList"></ul>
                    <ul>
                        <div class="card-footer">
                            <div class="input-group">
                                <textarea id="mensaje" class="form-control type_msg" placeholder="Type your message..."></textarea>
                                <div class="input-group-append" id="submitMsg">
                                    <span class="input-group-text send_btn"><i class="fas fa-location-arrow"></i></span>
                                </div>
                            </div>
                        </div>
                    </ul>
                </div>
            </div>
        </div>

        <script src="https://cdn.socket.io/3.1.1/socket.io.min.js" integrity="sha384-gDaozqUvc4HTgo8iZjwth73C6dDDeOJsAgpxBcMpZYztUfjHXpzrpdrHRdVp8ySO" crossorigin="anonymous"></script>

        <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>

        <script
            src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
            integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
            crossorigin="anonymous"
        ></script>
        <script>
            const socket = io();

            console.log('conectando socket');
            let usuario = '';
            let apellido = '';
            socket.on('conexion', (data) => {
                // usuario = prompt(data);
                // $('#myModal').modal('toggle');
                socket.emit('bienvenida', `Hola, recien me conecto`);
            });

            // $('#submit').click(function () {
            //     event.preventDefault();
            //     usuario = $('#nombre').val();
            //     apellido = $('#apellido').val();
            //     socket.id = usuario;
            //     socket.emit('bienvenida', `Soy ${socket.id}, gracias por recibirme`);
            // });

            document.getElementById('botonSub').addEventListener('click', function (event) {
                usuario = $('#nombre').val();
                apellido = $('#apellido').val();
                $('#myModal').modal('toggle');
                socket.id = usuario;
                socket.emit('bienvenida', `Soy ${socket.id}, gracias por recibirme`);
            });

            document.getElementById('submitMsg').addEventListener('click', function (event) {
                let mensajes = document.getElementById('mensaje');

                socket.emit('newMsg', {
                    id: usuario,
                    nombre: 'Silvio',
                    apellido: 'Delagente',
                    edad: 45,
                    alias: 'Anteojito',
                    avatar:
                        'https://www.google.com/url?sa=i&url=https%3A%2F%2Fmedium.com%2Fjavarevisited%2Fbash-script-tips-3265a30f4f86&psig=AOvVaw0b4E3W68ZwyksomOgQ2cJP&ust=1618164226160000&source=images&cd=vfe&ved=0CAIQjRxqFwoTCMi6mtOh9O8CFQAAAAAdAAAAABAJ',
                    text: mensajes.value
                });
                mensaje.value = '';
            });

            socket.on('recargMsg', function (mensajes) {
                let msgLista = document.getElementById('msgList');
                msgLista.innerHTML = '';
                mensajes.forEach((elem) => {
                    let cadaMsg = `<li>
                            <a target="_blank" href="mailto:${elem.email}">${elem.email}</a>
                            <a href="#" class="float-right">${elem.fecha}</a>
                            <p>
                                ${elem.mensaje}
                            </p>
                        </li>`;
                    msgLista.innerHTML += cadaMsg;
                });
                return;
            });
        </script>
    </body>
</html>
